/* zflick.js v@2.0a github.com/funnythingz/zflickjs | mit-license */
var zflickjs=function(a){this.id=document.getElementById(a.id);this.contents=document.getElementById(a.contents);this.col=this.contents.getElementsByClassName(a.col);this.lamp=(a.lamp)?document.getElementById(a.lamp):false;this.lampActiveClassName=(a.lampActiveClassName)?a.lampActiveClassName:"cur";this.btnPrev=(a.btn)?document.getElementById(a.btn.prev):false;this.btnNext=(a.btn)?document.getElementById(a.btn.next):false;this.btnActiveClassName=(a.btnActiveClassName)?a.btnActiveClassName:"zflickBtnCur";this.move=(a.move)?a.move:false;this.loop=(a.loop)?a.loop:false;this.autoChange=(a.autoChange)?a.autoChange:false;this.autoTimer=(a.autoTimer)?a.autoTimer:5000;this.cur=(a.cur)?a.cur:0;this.initCallback=(a.initCallback)?a.initCallback:function(){};this.moveCallback=(a.moveCallback)?a.moveCallback:function(){};this.isArgsWidth=(!a.width||a.width<=0)?false:true;this.idWidth=(this.isArgsWidth)?a.width:this.id.clientWidth;this.num=0;this.disX=(!a.disX||a.disX<=0)?5:a.disX;this.disY=(!a.disY||a.disY<=0)?5:a.disY;this.length=0;this.carray=[];this.warray=[];this.lamps=[];this.cloneLength=(a.cloneLength)?a.cloneLength:3;if(this.autoChange){this.autoChangeFlag=true;this.autoTimerCache=[]}this._cNowPos=0;this._cStartPosX=0;this._cStartPosY=0;this._cDistance=0;this._cHoge=0;this._orien=false;this._btnFlag=(a.btn)?true:false;this._ua=navigator.userAgent;this._initFlag=true;this._totalWidth=0;this.init()};zflickjs.prototype={init:function(){this.domInit(this);this.touchInit(this);if(this._btnFlag){this.clickPrevInit(this);this.clickNextInit(this)}this.createLamp(this);this.animation(this);this.resetAutoChange(this);this.initCallback();this.resizeInit(this)},touchInit:function(b){var a=false;b.contents.addEventListener("touchstart",function(c){b._cStartPosX=c.touches[0].clientX;b._cStartPosY=c.touches[0].clientY;b.killAutoChange(b)},false);b.contents.addEventListener("touchmove",function(c){if(Math.abs(b._cStartPosY-c.touches[0].clientY)>b.disY){}else{if(!a){b._cDistance=b._cStartPosX-c.touches[0].clientX;b._cHoge=b._cNowPos;if(b.disX<Math.abs(b._cDistance)&&(b._cDistance>0)){c.preventDefault();c.stopPropagation();b._cHoge=b._cNowPos-Math.abs(b._cDistance);b._orien=true;a=true}else{if(b.disX<Math.abs(b._cDistance)&&(b._cDistance<0)){c.preventDefault();c.stopPropagation();b._cHoge=b._cNowPos+Math.abs(b._cDistance);b._orien=false;a=true}}if(a){b.animation(b);b._cDistance=0;b.resetAutoChange(b)}}}},false);b.contents.addEventListener("touchend",function(c){a=false},false)},animation:function(a){if(a._orien){a.cur+=1;if(a.cur<a.length){if(a.loop&&(a.cur===(a.length-1))){a._cNowPos=(a.warray[0]+(a.idWidth*2));a.noTransAnimate(a);a._cNowPos=(a.warray[0]+a.idWidth)}else{a._cNowPos=a.warray[a.cur]}}else{if(a.loop&&(a.cur===a.length)){a._cNowPos=(a.warray[0]+a.idWidth);a.noTransAnimate(a);a._cNowPos=a.warray[a.cur]}a.cur=(!a.loop)?a.length-1:0;a._cNowPos=a.warray[a.cur]}}else{a.cur=(a._initFlag)?a.cur:(a.cur-1);if(a.cur>0){a._cNowPos=a.warray[a.cur];if(a.loop&&(a.cur===(a.length-2))){a._cNowPos=a.warray[(a.length-1)];a.noTransAnimate(a);a._cNowPos=(a.warray[a.cur])}}else{if(a.cur<=0){if(a.loop&&(a.cur<0)){a.cur=(a.length-1);a._cNowPos=(a.warray[(a.length-1)]-a.idWidth);a.noTransAnimate(a)}else{a.cur=0}a._cNowPos=a.warray[a.cur]}}}setTimeout(function(){a.transAnimate(a)},1);a.btnCurrentAction(a);a.setLamps(a,a.cur);a._initFlag=false},transAnimate:function(a){if(/AppleWebKit/.test(a._ua)){a.contents.style.webkitTransition="-webkit-transform 0.3s ease-in-out";a.contents.style.webkitTransform="translate3d("+a._cNowPos+"px, 0, 0)"}else{if(/Firefox/.test(a._ua)){a.contents.style.MozTransition="-moz-transform 0.3s ease-in-out";a.contents.style.MozTransform="translate3d("+a._cNowPos+"px, 0, 0)"}}setTimeout(function(){a.moveCallback()},300)},noTransAnimate:function(a){if(/AppleWebKit/.test(a._ua)){a.contents.style.webkitTransition="none";a.contents.style.webkitTransform="translate3d("+a._cNowPos+"px, 0, 0)"}else{if(/Firefox/.test(a._ua)){a.contents.style.MozTransition="none";a.contents.style.MozTransform="translate3d("+a._cNowPos+"px, 0, 0)"}}},btnCurrentAction:function(a){if(a._btnFlag){if(!a.loop){if(a.cur<=0){if(a.btnPrev.className.indexOf(a.btnActiveClassName)>0){a.btnPrev.className=a.btnPrev.className.replace(a.btnActiveClassName,"")}if(a.btnNext.className.indexOf(a.btnActiveClassName)<0){a.btnNext.className+=(" "+a.btnActiveClassName)}}else{if(a.cur===a.length-1){if(a.btnPrev.className.indexOf(a.btnActiveClassName)<0){a.btnPrev.className+=(" "+a.btnActiveClassName)}if(a.btnNext.className.indexOf(a.btnActiveClassName)>0){a.btnNext.className=a.btnNext.className.replace(a.btnActiveClassName,"")}}else{if(a.btnPrev.className.indexOf(a.btnActiveClassName)<0){a.btnPrev.className+=(" "+a.btnActiveClassName)}if(a.btnNext.className.indexOf(a.btnActiveClassName)<0){a.btnNext.className+=(" "+a.btnActiveClassName)}}}}else{if(a.btnNext.className.indexOf(a.btnActiveClassName)<0){a.btnNext.className+=(" "+a.btnActiveClassName)}if(a.btnPrev.className.indexOf(a.btnActiveClassName)<0){a.btnPrev.className+=(" "+a.btnActiveClassName)}}}},clickPrevInit:function(a){a.btnPrev.addEventListener("click",function(b){a._orien=false;a.animation(a);a.killAutoChange(a);setTimeout(function(){a.resetAutoChange(a)},a.autoTimer)},false)},clickNextInit:function(a){a.btnNext.addEventListener("click",function(b){a._orien=true;a.animation(a);a.killAutoChange(a);setTimeout(function(){a.resetAutoChange(a)},a.autoTimer)},false)},resizeInit:function(b){var a=b;var c=false;window.addEventListener("resize",function(){if(c!==false){clearTimeout(c)}c=setTimeout(function(){a.domInit(a);a.animation(a);a.resetAutoChange(a)},200)},false)},domInit:function(a){a.id.style.width="auto";if(!a.isArgsWidth){a.idWidth=a.id.clientWidth}a.length=a.col.length;a.id.style.width=a.idWidth+"px";if(!a.loop){a.contents.style.width=a.getContentsWidth()+"px"}else{a._totalWidth=a.getContentsWidth();a.contents.style.width=(a._totalWidth*a.cloneLength)+"px";a.cloneNode(a.cloneLength);a.loopInitPos()}},createLamp:function(b){if(b.lamp){for(var a=0;a<b.length;a++){b.lamps[a]=document.createElement("div");b.lamp.appendChild(b.lamps[a])}}},setLamps:function(c,a){if(c.lamp){for(var b=0;b<c.length;b++){c.lamps[b].setAttribute("class","")}c.lamps[a].setAttribute("class",c.lampActiveClassName)}},getContentsWidth:function(){var b=0;var d={};for(var e=0,a=this.length;e<a;e++){var f=this.col[e];this.carray[e]=this.idWidth;this.warray[e]=-(b);b+=this.idWidth}return b},loopInitPos:function(){for(var b=0,a=this.length;b<a;b++){this.warray[b]-=this._totalWidth}},cloneNode:function(b){b=b-1;for(var d=0;d<b;d++){for(var c=0,a=this.length;c<a;c++){cloneNode=this.col[c].cloneNode(true);cloneNode.setAttribute("clone","clone");this.contents.appendChild(cloneNode)}}},autoChangeFunc:function(a){if(!a.autoChangeFlag){a.autoTimerCache.push(setInterval(function(){a.autoChangeFlag=true;if(!a.loop){if(a.cur===a.length-1){a._orien=false;a.cur=0}else{a._orien=true}}else{a._orien=true}a.animation(a)},a.autoTimer))}},resetAutoChange:function(a){if(a.autoChange){a.killAutoChange(a);a.autoChangeFunc(a)}},killAutoChange:function(c){if(this.autoChange){c.autoChangeFlag=false;for(var b=0,a=c.autoTimerCache.length;b<a;b++){clearInterval(c.autoTimerCache[b]);c.autoTimerCache.splice(b,1)}}}};
