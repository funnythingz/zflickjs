/* zflick.js v@2.1 http://funnythingz.github.com/zflickjs/ | mit-license */
var zflickjs=function(a){this.id=document.getElementById(a.id);this.contents=document.getElementById(a.contents);this.col=this.contents.getElementsByClassName(a.col);this.lamp=(a.lamp)?document.getElementById(a.lamp):false;this.lampActiveClassName=(a.lampActiveClassName)?a.lampActiveClassName:"cur";this.btnPrev=(a.btn)?document.getElementById(a.btn.prev):false;this.btnNext=(a.btn)?document.getElementById(a.btn.next):false;this.btnActiveClassName=(a.btnActiveClassName)?a.btnActiveClassName:"zflickBtnCur";this.move=(a.move)?a.move:false;this.loop=(a.loop)?a.loop:false;this.autoChange=(a.autoChange)?a.autoChange:false;this.autoTimer=(a.autoTimer)?a.autoTimer:5000;this.cur=(a.cur)?a.cur:0;this.initCallback=(a.initCallback)?a.initCallback:function(){};this.moveCallback=(a.moveCallback)?a.moveCallback:function(){};this.isArgsWidth=(!a.width||a.width<=0)?false:true;this.idWidth=(this.isArgsWidth)?a.width:this.id.clientWidth;this.num=0;this.disX=(!a.disX||a.disX<=0)?5:a.disX;this.disY=(!a.disY||a.disY<=0)?5:a.disY;this.length=0;this.carray=[];this.warray=[];this.lamps=[];this.cloneLength=(a.cloneLength)?a.cloneLength:3;if(this.autoChange){this.autoChangeFlag=true;this.autoTimerCache=[]}this._cNowPos=0;this._cStartPosX=0;this._cStartPosY=0;this._cDistance=0;this._cHoge=0;this._orien=false;this._btnFlag=(a.btn)?true:false;this._ua=navigator.userAgent;this._initFlag=true;this._totalWidth=0;this.init()};zflickjs.prototype={init:function(){this.domInit();this.touchInit();if(this._btnFlag){this.clickPrevInit();this.clickNextInit()}this.createLamp();this.animation(this);this.resetAutoChange();this.initCallback()},touchInit:function(){var a=false;var b=this;this.contents.addEventListener("touchstart",function(c){b._cStartPosX=c.touches[0].clientX;b._cStartPosY=c.touches[0].clientY;b.killAutoChange()},false);this.contents.addEventListener("touchmove",function(c){if(Math.abs(b._cStartPosY-c.touches[0].clientY)>b.disY){}else{if(!a){b._cDistance=b._cStartPosX-c.touches[0].clientX;b._cHoge=b._cNowPos;if(b.disX<Math.abs(b._cDistance)&&(b._cDistance>0)){c.preventDefault();c.stopPropagation();b._cHoge=b._cNowPos-Math.abs(b._cDistance);b._orien=true;a=true}else{if(b.disX<Math.abs(b._cDistance)&&(b._cDistance<0)){c.preventDefault();c.stopPropagation();b._cHoge=b._cNowPos+Math.abs(b._cDistance);b._orien=false;a=true}}if(a){b.animation(b);b._cDistance=0;b.resetAutoChange()}}}},false);this.contents.addEventListener("touchend",function(c){a=false},false)},animation:function(a){if(a._orien){a.cur+=1;if(a.cur<a.length){if(a.loop&&(a.cur===(a.length-1))){a._cNowPos=(a.warray[0]+(a.idWidth*2));a.noTransAnimate(a);a._cNowPos=(a.warray[0]+a.idWidth)}else{a._cNowPos=a.warray[a.cur]}}else{if(a.loop&&(a.cur===a.length)){a._cNowPos=(a.warray[0]+a.idWidth);a.noTransAnimate(a);a._cNowPos=a.warray[a.cur]}a.cur=(!a.loop)?a.length-1:0;a._cNowPos=a.warray[a.cur]}}else{a.cur=(a._initFlag)?a.cur:(a.cur-1);if(a.cur>0){a._cNowPos=a.warray[a.cur];if(a.loop&&(a.cur===(a.length-2))){a._cNowPos=a.warray[(a.length-1)];a.noTransAnimate(a);a._cNowPos=(a.warray[a.cur])}}else{if(a.cur<=0){if(a.loop&&(a.cur<0)){a.cur=(a.length-1);a._cNowPos=(a.warray[(a.length-1)]-a.idWidth);a.noTransAnimate(a)}else{a.cur=0}a._cNowPos=a.warray[a.cur]}}}setTimeout(function(){a.transAnimate(a)},1);a.btnCurrentAction();a.setLamps(a.cur);a._initFlag=false},transAnimate:function(a){if(/AppleWebKit/.test(a._ua)){a.contents.style.webkitTransition="-webkit-transform 0.3s ease-in-out";a.contents.style.webkitTransform="translate3d("+a._cNowPos+"px, 0, 0)"}else{if(/Firefox/.test(a._ua)){a.contents.style.MozTransition="-moz-transform 0.3s ease-in-out";a.contents.style.MozTransform="translate3d("+a._cNowPos+"px, 0, 0)"}}setTimeout(function(){a.moveCallback()},300)},noTransAnimate:function(a){if(/AppleWebKit/.test(a._ua)){a.contents.style.webkitTransition="none";a.contents.style.webkitTransform="translate3d("+a._cNowPos+"px, 0, 0)"}else{if(/Firefox/.test(a._ua)){a.contents.style.MozTransition="none";a.contents.style.MozTransform="translate3d("+a._cNowPos+"px, 0, 0)"}}},btnCurrentAction:function(){if(this._btnFlag){if(!this.loop){if(this.cur<=0){if(this.btnPrev.className.indexOf(this.btnActiveClassName)>0){this.btnPrev.className=this.btnPrev.className.replace(this.btnActiveClassName,"")}if(this.btnNext.className.indexOf(this.btnActiveClassName)<0){this.btnNext.className+=(" "+this.btnActiveClassName)}}else{if(this.cur===this.length-1){if(this.btnPrev.className.indexOf(this.btnActiveClassName)<0){this.btnPrev.className+=(" "+this.btnActiveClassName)}if(this.btnNext.className.indexOf(this.btnActiveClassName)>0){this.btnNext.className=this.btnNext.className.replace(this.btnActiveClassName,"")}}else{if(this.btnPrev.className.indexOf(this.btnActiveClassName)<0){this.btnPrev.className+=(" "+this.btnActiveClassName)}if(this.btnNext.className.indexOf(this.btnActiveClassName)<0){this.btnNext.className+=(" "+this.btnActiveClassName)}}}}else{if(this.btnNext.className.indexOf(this.btnActiveClassName)<0){this.btnNext.className+=(" "+this.btnActiveClassName)}if(this.btnPrev.className.indexOf(this.btnActiveClassName)<0){this.btnPrev.className+=(" "+this.btnActiveClassName)}}}},clickPrevInit:function(){var a=this;this.btnPrev.addEventListener("click",function(b){a._orien=false;a.animation(a);a.killAutoChange();setTimeout(function(){a.resetAutoChange()},a.autoTimer)},false)},clickNextInit:function(){var a=this;this.btnNext.addEventListener("click",function(b){a._orien=true;a.animation(a);a.killAutoChange();setTimeout(function(){a.resetAutoChange()},a.autoTimer)},false)},resizeInit:function(){var a=this;var b=false;window.addEventListener("resize",function(){if(b!==false){clearTimeout(b)}b=setTimeout(function(){a.domInit();a.animation(a);a.resetAutoChange()},200)},false)},domInit:function(){this.id.style.width="auto";if(!this.isArgsWidth){this.idWidth=this.id.clientWidth}this.length=this.col.length;this.id.style.width=this.idWidth+"px";if(!this.loop){this.contents.style.width=this.getContentsWidth()+"px"}else{this._totalWidth=this.getContentsWidth();this.contents.style.width=(this._totalWidth*this.cloneLength)+"px";this.cloneNode(this.cloneLength);this.loopInitPos()}},createLamp:function(){var a=this;if(this.lamp){for(var b=0;b<this.length;b++){this.lamps[b]=document.createElement("div");(function(c){a.lamps[c].addEventListener("click",function(){if(a.autoChange){a.killAutoChange()}a.cur=(a._orien)?c-1:c+1;a.animation(a);a.btnCurrentAction();a.setLamps(a.cur);if(a.autoChange){a.autoChangeFunc()}},false)})(b);this.lamp.appendChild(this.lamps[b])}}},setLamps:function(a){if(this.lamp){for(var b=0;b<this.length;b++){this.lamps[b].setAttribute("class","")}this.lamps[a].setAttribute("class",this.lampActiveClassName)}},getContentsWidth:function(){var b=0;var d={};for(var e=0,a=this.length;e<a;e++){var f=this.col[e];this.carray[e]=this.idWidth;this.warray[e]=-(b);b+=this.idWidth}return b},loopInitPos:function(){for(var b=0,a=this.length;b<a;b++){this.warray[b]-=this._totalWidth}},cloneNode:function(d){d-=1;for(var c=0;c<d;c++){for(var b=0,a=this.length;b<a;b++){cloneNode=this.col[b].cloneNode(true);cloneNode.setAttribute("clone","clone");this.contents.appendChild(cloneNode)}}},autoChangeFunc:function(){if(!this.autoChangeFlag){var a=this;this.autoTimerCache.push(setInterval(function(){a.autoChangeFlag=true;if(!a.loop){if(a.cur===a.length-1){a._orien=false;a.cur=0}else{a._orien=true}}else{a._orien=true}a.animation(a)},this.autoTimer))}},resetAutoChange:function(){if(this.autoChange){this.killAutoChange();this.autoChangeFunc()}},killAutoChange:function(){if(this.autoChange){this.autoChangeFlag=false;for(var b=0,a=this.autoTimerCache.length;b<a;b++){clearInterval(this.autoTimerCache[b]);this.autoTimerCache.splice(b,1)}}}};
